{% extends "layout.html" %}

{% block title %}
    Index
{% endblock %}

{% block main %}
<form action="/create" method="post" onsubmit="">
    <div class="form-group">
        <select name='known' class="form-control bg-secondary text-white" id="known">
            <option disabled selected value="">Categories</option>
            {% for cat in categories %}
                <option value="{{cat}}"> {{cat}} </option>
            {% endfor %}
        </select> 
    </div>
    <div class="form-group">
        <input autocomplete="off" autofocus class="form-control" 
        name="category" placeholder="(New) Category" type="text"
        id = 'category' required onchange="">
    </div>
    <div class="form-group">
        <input autocomplete="off" autofocus class="form-control" 
        name="url" placeholder="(paste URL)" type="text"
        required onchange="checkURL();">
    </div>
    <div class="form-group">
        <input class="form-control" name="title" placeholder="title" 
        type="text" required>
    </div>
    <div class="form-group">
        <textarea class="form-control" rows="4"  name='description' 
        placeholder = "description" id=""></textarea>
    </div>
    <button class="btn btn-primary" type="submit">Bookmark</button>
</form>
<script>
    function getHTML(html){
        //alert(html);
        var elem = document.querySelector('input[name="title"]');
        var doc = new DOMParser().parseFromString(html, 'text/html');
        var title = doc.querySelector('title').innerHTML;
        elem.value = title;
        elem.focus();
    };

    function showError(xhr){
        alert('Error:' + xhr.status + " " + xhr.statusText);
    };

    function checkURL(){
        var urlStr = document.querySelector("input[name='url']").value;
        try{
            url = new URL(urlStr);
            //alert(url);
        }
        catch(_){
            alert('Invalid url');
            return false;
        }
        if (url.protocol === 'http:' || url.protocol === 'https:')
        {
            return true;
            //$.ajax({url: url})
            //.done(html => {getHTML(html);})
            //.fail(xhr => {});
        }
        else return false;
    }

    // the wrapper is needed to prevent any jQuery
        // code from running before the document is 
        // finished loading
        $(document).ready(function(){ 
            $("select").change(function(){
                var selected = document.getElementById('known').value;
                document.getElementById('category').value = selected;
            });
        });

     // initializes tooltips in bootstrap 4
     $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip();
        $('[data-toggle-second="tooltip"]').tooltip();
    });
</script>
{% endblock %}